<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>View Enquiry - PMC Admission</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
  </head>
  <body class="bg-gray-50">
    <div class="max-w-6xl mx-auto p-8">
      <a href="/templates/admin/enquiries.html" class="text-indigo-600 hover:text-indigo-900 mb-4 inline-block flex items-center gap-1">
        <span class="material-symbols-outlined">arrow_back</span> Back to Enquiries
      </a>

      <div id="enquiry-card" class="bg-white rounded-lg shadow">
        <div id="enquiry-header" class="bg-gradient-to-r from-indigo-600 to-indigo-700 text-white p-6 rounded-t-lg">
          <div class="flex justify-between items-start">
            <div>
              <h2 id="student-name" class="text-3xl font-bold">Loading…</h2>
              <p id="enquiry-id" class="text-indigo-100 mt-1">Enquiry ID: —</p>
            </div>
            <span id="enquiry-status" class="px-4 py-2 inline-flex text-sm font-semibold rounded-full bg-blue-100 text-blue-800">—</span>
          </div>
        </div>

        <div class="p-6">
          <!-- Personal Information -->
          <section class="mb-8">
            <h3 class="text-xl font-bold text-gray-800 mb-4 pb-2 border-b-2 border-indigo-200">Personal Information</h3>
            <div class="grid grid-cols-2 gap-6 md:grid-cols-3">
              <div>
                <label class="text-sm font-semibold text-gray-600">Full Name</label>
                <p id="field-full_name" class="text-gray-900 text-lg">—</p>
              </div>
              <div>
                <label class="text-sm font-semibold text-gray-600">Unique ID</label>
                <p id="field-unique_id" class="text-gray-900 text-lg font-mono">—</p>
              </div>
              <div>
                <label class="text-sm font-semibold text-gray-600">+2 Register Number</label>
                <p id="field-plus2_register_number" class="text-gray-900 text-lg">—</p>
              </div>
              <div>
                <label class="text-sm font-semibold text-gray-600">Date of Birth</label>
                <p id="field-date_of_birth" class="text-gray-900 text-lg">—</p>
              </div>
              <div>
                <label class="text-sm font-semibold text-gray-600">Gender</label>
                <p id="field-gender" class="text-gray-900 text-lg">—</p>
              </div>
              <div>
                <label class="text-sm font-semibold text-gray-600">Aadhar Number</label>
                <p id="field-aadhar_number" class="text-gray-900 text-lg">—</p>
              </div>
            </div>
          </section>

          <!-- Contact Information -->
          <section class="mb-8">
            <h3 class="text-xl font-bold text-gray-800 mb-4 pb-2 border-b-2 border-indigo-200">Contact Information</h3>
            <div class="grid grid-cols-2 gap-6 md:grid-cols-3">
              <div>
                <label class="text-sm font-semibold text-gray-600">WhatsApp Number</label>
                <p id="field-whatsapp_number" class="text-gray-900 text-lg">—</p>
              </div>
              <div>
                <label class="text-sm font-semibold text-gray-600">Email</label>
                <p id="field-email" class="text-gray-900 text-lg break-all">—</p>
              </div>
              <div>
                <label class="text-sm font-semibold text-gray-600">Mother Tongue</label>
                <p id="field-mother_tongue" class="text-gray-900 text-lg">—</p>
              </div>
            </div>
          </section>

          <!-- Academic Details (from academics table) -->
          <section class="mb-8">
            <h3 class="text-xl font-bold text-gray-800 mb-4 pb-2 border-b-2 border-indigo-200">Academic Details</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div class="bg-blue-50 p-3 rounded">
                <p class="text-xs text-gray-600">Maths</p>
                <p id="academics-maths_marks" class="text-2xl font-bold text-blue-600">—</p>
              </div>
              <div class="bg-green-50 p-3 rounded">
                <p class="text-xs text-gray-600">Physics</p>
                <p id="academics-physics_marks" class="text-2xl font-bold text-green-600">—</p>
              </div>
              <div class="bg-orange-50 p-3 rounded">
                <p class="text-xs text-gray-600">Chemistry</p>
                <p id="academics-chemistry_marks" class="text-2xl font-bold text-orange-600">—</p>
              </div>
            </div>
          </section>

          <!-- Metadata -->
          <section class="bg-gray-50 p-4 rounded-lg">
            <h3 class="text-sm font-bold text-gray-800 mb-3">Enquiry Metadata</h3>
            <div class="grid grid-cols-2 gap-4 md:grid-cols-4 text-sm">
              <div>
                <label class="text-xs font-semibold text-gray-600">Created Date</label>
                <p id="meta-created-date" class="text-gray-900">—</p>
              </div>
              <div>
                <label class="text-xs font-semibold text-gray-600">Created Time</label>
                <p id="meta-created-time" class="text-gray-900">—</p>
              </div>
              <div>
                <label class="text-xs font-semibold text-gray-600">Updated Date</label>
                <p id="meta-updated-date" class="text-gray-900">—</p>
              </div>
              <div>
                <label class="text-xs font-semibold text-gray-600">Status</label>
                <p id="meta-status" class="text-gray-900 font-semibold">—</p>
              </div>
            </div>
          </section>

          <div class="flex gap-4 mt-8 pt-6 border-t">
            <a href="/templates/admin/enquiries.html" class="flex-1 bg-gray-300 text-gray-700 px-6 py-3 rounded-lg hover:bg-gray-400 text-center font-semibold transition-colors">Back to List</a>
          </div>
        </div>
      </div>
    </div>

    <script>
      // helper to format date/time
      function fmtDate(dt){ if(!dt) return 'N/A'; try{ const d=new Date(dt); return d.toISOString().slice(0,10);}catch(e){return dt;} }
      function fmtTime(dt){ if(!dt) return 'N/A'; try{ const d=new Date(dt); return d.toISOString().slice(11,16);}catch(e){return dt;} }

      function setText(id, value){ const el=document.getElementById(id); if(el) el.textContent = (value===undefined || value===null || value==='') ? '—' : String(value); }

      async function load(){
        const qp = new URLSearchParams(window.location.search);
        const eid = qp.get('enquiry_id') || qp.get('enquiry') || qp.get('id');
        if(!eid){ alert('enquiry_id missing in URL'); return; }
        // fetch enquiry
        const enr = await fetch('/api/enquiries/' + encodeURIComponent(eid));
        if(!enr.ok){ const txt=await enr.text(); console.error('enquiry fetch failed',txt); alert('Failed to load enquiry'); return; }
        const enquiry = await enr.json();
        setText('student-name', enquiry.student_name || enquiry.full_name || '—');
        setText('enquiry-id', 'Enquiry ID: ' + (enquiry.id || '—'));
        setText('enquiry-status', (enquiry.status||'').replace('_',' ') || '—');

        // load student
        if(enquiry.student_id){
          const sres = await fetch('/api/students/' + encodeURIComponent(enquiry.student_id));
          if(sres.ok){ const student = await sres.json();
            ['full_name','unique_id','plus2_register_number','date_of_birth','gender','aadhar_number','whatsapp_number','email','mother_tongue'].forEach(k=> setText('field-'+k, student[k]));
          }
          // academics
          const ares = await fetch('/api/academics?student_id=' + encodeURIComponent(enquiry.student_id));
          if(ares.ok){ const acad = await ares.json(); if(Array.isArray(acad) && acad.length>0){ const a = acad[0]; setText('academics-maths_marks', a.maths_marks); setText('academics-physics_marks', a.physics_marks); setText('academics-chemistry_marks', a.chemistry_marks); } }
        }

        // metadata
        setText('meta-created-date', fmtDate(enquiry.created_at));
        setText('meta-created-time', fmtTime(enquiry.created_at));
        setText('meta-updated-date', fmtDate(enquiry.updated_at));
        setText('meta-status', enquiry.status || '—');
      }

      document.addEventListener('DOMContentLoaded', load);
    </script>
  </body>
</html>
