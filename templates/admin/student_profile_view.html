<!DOCTYPE html>
<html class="light" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Student Profile - {{ profile.student.full_name or profile.student.name }}</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Lexend:wght@100..900&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<style>
body{font-family:'Lexend',sans-serif}
.material-symbols-outlined{font-variation-settings:'FILL' 0,'wght' 400,'GRAD' 0,'opsz' 24}
@media print{
.no-print{display:none!important}
body{background:#fff!important}
}
</style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-900 dark:to-slate-800 text-[#111418] dark:text-white min-h-screen">

<!-- Header -->
<header class="bg-white dark:bg-[#1a202c] border-b border-[#e5e7eb] dark:border-[#2d3748] sticky top-0 z-50 shadow-sm no-print">
<div class="max-w-[1400px] mx-auto px-6 py-4 flex items-center justify-between">
<div class="flex items-center gap-3">
<div class="w-10 h-10 rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center text-white font-bold text-sm">
{{ (profile.student.full_name or profile.student.name or 'S')[0]|upper }}
</div>
<div>
<h2 class="text-xl font-bold">{{ profile.student.full_name or profile.student.name or 'Student Profile' }}</h2>
<p class="text-xs text-slate-500 dark:text-slate-400">ID: {{ profile.student.unique_id or 'N/A' }}</p>
</div>
</div>
<div class="flex items-center gap-2">
<button onclick="downloadPDF()" class="inline-flex items-center gap-2 bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg font-medium transition-colors shadow-md">
<span class="material-symbols-outlined text-sm">download</span>
Download PDF
</button>
<a href="{{ url_for('admin.student_profiles') }}" class="inline-flex items-center gap-2 bg-slate-500 hover:bg-slate-600 text-white px-4 py-2 rounded-lg font-medium transition-colors shadow-md">
<span class="material-symbols-outlined text-sm">arrow_back</span>
Back
</a>
</div>
</header>

<main class="max-w-[1400px] mx-auto p-6">

<!-- Personal Information -->
<div class="bg-white dark:bg-[#1a202c] rounded-xl border border-[#e5e7eb] dark:border-[#2d3748] overflow-hidden shadow-md mb-6">
<div class="bg-gradient-to-r from-blue-500 to-blue-600 px-6 py-4">
<h3 class="text-white text-lg font-bold flex items-center gap-2">
<span class="material-symbols-outlined">person</span>
Personal Information
</h3>
</div>
<div class="p-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
<div>
<p class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-1">Full Name</p>
<p class="text-base font-semibold text-[#111418] dark:text-white">{{ profile.student.full_name or profile.student.name or 'N/A' }}</p>
</div>
<div>
<p class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-1">Email</p>
<p class="text-base font-semibold text-[#111418] dark:text-white break-all">{{ profile.student.email or 'N/A' }}</p>
</div>
<div>
<p class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-1">Phone</p>
<p class="text-base font-semibold text-[#111418] dark:text-white">{{ profile.student.phone or 'N/A' }}</p>
</div>
<div>
<p class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-1">Gender</p>
<p class="text-base font-semibold text-[#111418] dark:text-white capitalize">{{ profile.student.gender or 'N/A' }}</p>
</div>
<div>
<p class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-1">Date of Birth</p>
<p class="text-base font-semibold text-[#111418] dark:text-white">{{ profile.student.dob or 'N/A' }}</p>
</div>
<div>
<p class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-1">Status</p>
<span class="inline-block px-3 py-1 rounded-full text-xs font-bold bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300">{{ profile.student.status or 'N/A' }}</span>
</div>
<div>
<p class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-1">Community</p>
<p class="text-base font-semibold text-[#111418] dark:text-white">{{ profile.student.community or 'N/A' }}</p>
</div>
<div>
<p class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-1">Religion</p>
<p class="text-base font-semibold text-[#111418] dark:text-white">{{ profile.student.religion or 'N/A' }}</p>
</div>
</div>
</div>

<!-- Academic Details -->
{% if profile.academic %}
<div class="bg-white dark:bg-[#1a202c] rounded-xl border border-[#e5e7eb] dark:border-[#2d3748] overflow-hidden shadow-md mb-6">
<div class="bg-gradient-to-r from-indigo-500 to-indigo-600 px-6 py-4">
<h3 class="text-white text-lg font-bold flex items-center gap-2">
<span class="material-symbols-outlined">school</span>
Academic Information
</h3>
</div>
<div class="p-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
<div>
<p class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-1">School Name</p>
<p class="text-base font-semibold text-[#111418] dark:text-white">{{ profile.academic.school_name or 'N/A' }}</p>
</div>
<div>
<p class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-1">HSC Percentage</p>
<p class="text-base font-bold text-amber-600 dark:text-amber-400">{{ profile.student.plus2_percentage or 'N/A' }}%</p>
</div>
<div>
<p class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-1">Cutoff Score</p>
<p class="text-base font-bold text-orange-600 dark:text-orange-400">{{ profile.academic.cutoff or 'N/A' }}</p>
</div>
<div>
<p class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-1">TNEA Eligible</p>
<p class="text-base font-semibold text-[#111418] dark:text-white">{{ profile.academic.tnea_eligible or 'N/A' }}</p>
</div>
<div>
<p class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-1">TNEA Average</p>
<p class="text-base font-semibold text-[#111418] dark:text-white">{{ profile.academic.tnea_average or 'N/A' }}</p>
</div>
</div>
</div>
{% endif %}

<!-- Admissions & Branch Assignments -->
{% if profile.admissions %}
<div class="bg-white dark:bg-[#1a202c] rounded-xl border border-[#e5e7eb] dark:border-[#2d3748] overflow-hidden shadow-md mb-6">
<div class="bg-gradient-to-r from-purple-500 to-purple-600 px-6 py-4">
<h3 class="text-white text-lg font-bold flex items-center gap-2">
<span class="material-symbols-outlined">assignment</span>
Branch Assignment
</h3>
</div>
<div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
{% for adm in profile.admissions %}
<div class="p-4 bg-gradient-to-br from-slate-50 to-slate-100 dark:from-[#2d3748] dark:to-[#1a202c] rounded-lg border border-[#e5e7eb] dark:border-[#4a5568]">
<div class="space-y-3">
<div>
<p class="text-xs font-semibold text-slate-600 dark:text-slate-300 mb-1">Preferred Branch</p>
<p class="text-base font-bold text-blue-600 dark:text-blue-400">{{ adm.preferred_dept_name or 'N/A' }}</p>
</div>
<div>
<p class="text-xs font-semibold text-slate-600 dark:text-slate-300 mb-1">Optional Branches</p>
<p class="text-base font-semibold text-[#111418] dark:text-white">{{ adm.optional_dept_name or 'N/A' }}</p>
</div>
</div>
</div>
{% endfor %}
</div>
</div>
{% endif %}

<!-- Applications & Documents -->
{% if profile.applications %}
<div class="bg-white dark:bg-[#1a202c] rounded-xl border border-[#e5e7eb] dark:border-[#2d3748] overflow-hidden shadow-md mb-6">
<div class="bg-gradient-to-r from-green-500 to-green-600 px-6 py-4">
<h3 class="text-white text-lg font-bold flex items-center gap-2">
<span class="material-symbols-outlined">description</span>
Applications & Documents
</h3>
</div>
<div class="p-6 space-y-6">
{% for app in profile.applications %}
<div class="p-4 bg-gradient-to-br from-slate-50 to-slate-100 dark:from-[#2d3748] dark:to-[#1a202c] rounded-lg border border-[#e5e7eb] dark:border-[#4a5568]">
<p class="text-sm font-bold text-[#111418] dark:text-white mb-4">Application {{ app.app_id }}</p>

<div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-3">
    <div>
        <p class="text-xs text-gray-600">Applied GQ</p>
        <p class="font-semibold text-green-700">{% if app.applied_gq %}Yes{% else %}No{% endif %}</p>
    </div>
    <div>
        <p class="text-xs text-gray-600">GQ Application #</p>
        <p class="font-semibold">{{ app.gq_application_number or app.counselling_application_number or 'N/A' }}</p>
    </div>
    <div>
        <p class="text-xs text-gray-600">GQ Applied Date</p>
        <p class="font-semibold">{{ app.gq_applied_at or app.counselling_applied_at or 'N/A' }}</p>
    </div>
    <div>
        <p class="text-xs text-gray-600">Applied MQ</p>
        <p class="font-semibold text-indigo-700">{% if app.applied_mq %}Yes{% else %}No{% endif %}</p>
    </div>
    <div>
        <p class="text-xs text-gray-600">MQ Consortium #</p>
        <p class="font-semibold">{{ app.mq_consortium_number or 'N/A' }}</p>
    </div>
    <div>
        <p class="text-xs text-gray-600">MQ Applied Date</p>
        <p class="font-semibold">{{ app.mq_applied_at or 'N/A' }}</p>
    </div>
</div>

<!-- Documents Section for this Application -->
{% if profile.documents_by_app and profile.documents_by_app.get(app.app_id) %}
<div class="mt-4">
<p class="text-xs font-bold text-slate-600 dark:text-slate-300 uppercase tracking-wider mb-3">Documents</p>
<div class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-7 gap-3">
{% set docs = profile.documents_by_app.get(app.app_id, {}) %}

<!-- 10th Mark Sheet -->
<div class="flex flex-col items-center gap-1">
{% if docs.get('10th_Mark_Sheet') %}
<a href="{{ docs['10th_Mark_Sheet'].document_url }}" target="_blank" rel="noopener noreferrer" title="View 10th Mark Sheet" class="flex items-center justify-center bg-blue-500 hover:bg-blue-600 text-white text-xs font-bold py-2 px-3 rounded transition-all shadow-sm w-full">
<span class="material-symbols-outlined text-sm">visibility</span>
</a>
{% else %}
<span class="flex items-center justify-center text-xs text-slate-400 bg-slate-200 dark:bg-slate-700 px-3 py-2 rounded w-full">-</span>
{% endif %}
<span class="text-xs font-semibold text-slate-600 dark:text-slate-400">10th</span>
</div>

<!-- 12th Mark Sheet -->
<div class="flex flex-col items-center gap-1">
{% if docs.get('12th_Mark_Sheet') %}
<a href="{{ docs['12th_Mark_Sheet'].document_url }}" target="_blank" rel="noopener noreferrer" title="View 12th Mark Sheet" class="flex items-center justify-center bg-cyan-500 hover:bg-cyan-600 text-white text-xs font-bold py-2 px-3 rounded transition-all shadow-sm w-full">
<span class="material-symbols-outlined text-sm">visibility</span>
</a>
{% else %}
<span class="flex items-center justify-center text-xs text-slate-400 bg-slate-200 dark:bg-slate-700 px-3 py-2 rounded w-full">-</span>
{% endif %}
<span class="text-xs font-semibold text-slate-600 dark:text-slate-400">12th</span>
</div>

<!-- Community Certificate -->
<div class="flex flex-col items-center gap-1">
{% if docs.get('Community_Certificate') %}
<a href="{{ docs['Community_Certificate'].document_url }}" target="_blank" rel="noopener noreferrer" title="View Community Certificate" class="flex items-center justify-center bg-teal-500 hover:bg-teal-600 text-white text-xs font-bold py-2 px-3 rounded transition-all shadow-sm w-full">
<span class="material-symbols-outlined text-sm">visibility</span>
</a>
{% else %}
<span class="flex items-center justify-center text-xs text-slate-400 bg-slate-200 dark:bg-slate-700 px-3 py-2 rounded w-full">-</span>
{% endif %}
<span class="text-xs font-semibold text-slate-600 dark:text-slate-400">CC</span>
</div>

<!-- Transfer Certificate -->
<div class="flex flex-col items-center gap-1">
{% if docs.get('Transfer_Certificate') %}
<a href="{{ docs['Transfer_Certificate'].document_url }}" target="_blank" rel="noopener noreferrer" title="View Transfer Certificate" class="flex items-center justify-center bg-indigo-500 hover:bg-indigo-600 text-white text-xs font-bold py-2 px-3 rounded transition-all shadow-sm w-full">
<span class="material-symbols-outlined text-sm">visibility</span>
</a>
{% else %}
<span class="flex items-center justify-center text-xs text-slate-400 bg-slate-200 dark:bg-slate-700 px-3 py-2 rounded w-full">-</span>
{% endif %}
<span class="text-xs font-semibold text-slate-600 dark:text-slate-400">TC</span>
</div>

<!-- FG Certificate -->
<div class="flex flex-col items-center gap-1">
{% if docs.get('FG_Certificate') %}
<a href="{{ docs['FG_Certificate'].document_url }}" target="_blank" rel="noopener noreferrer" title="View FG Certificate" class="flex items-center justify-center bg-emerald-500 hover:bg-emerald-600 text-white text-xs font-bold py-2 px-3 rounded transition-all shadow-sm w-full">
<span class="material-symbols-outlined text-sm">visibility</span>
</a>
{% else %}
<span class="flex items-center justify-center text-xs text-slate-400 bg-slate-200 dark:bg-slate-700 px-3 py-2 rounded w-full">-</span>
{% endif %}
<span class="text-xs font-semibold text-slate-600 dark:text-slate-400">FG</span>
</div>

<!-- Passport Photo -->
<div class="flex flex-col items-center gap-1">
{% if docs.get('Passport_Photo') %}
<a href="{{ docs['Passport_Photo'].document_url }}" target="_blank" rel="noopener noreferrer" title="View Passport Photo" class="flex items-center justify-center bg-purple-500 hover:bg-purple-600 text-white text-xs font-bold py-2 px-3 rounded transition-all shadow-sm w-full">
<span class="material-symbols-outlined text-sm">visibility</span>
</a>
{% else %}
<span class="flex items-center justify-center text-xs text-slate-400 bg-slate-200 dark:bg-slate-700 px-3 py-2 rounded w-full">-</span>
{% endif %}
<span class="text-xs font-semibold text-slate-600 dark:text-slate-400">Photo</span>
</div>

<!-- Allotment Order -->
<div class="flex flex-col items-center gap-1">
{% set allotment = profile.counselling | selectattr('app_id', 'equalto', app.app_id) | first if profile.counselling else None %}
{% if allotment and allotment.allotment_order_url %}
<a href="{{ allotment.allotment_order_url }}" target="_blank" rel="noopener noreferrer" title="View Allotment Order" class="flex items-center justify-center bg-orange-500 hover:bg-orange-600 text-white text-xs font-bold py-2 px-3 rounded transition-all shadow-sm w-full">
<span class="material-symbols-outlined text-sm">visibility</span>
</a>
{% else %}
<span class="flex items-center justify-center text-xs text-slate-400 bg-slate-200 dark:bg-slate-700 px-3 py-2 rounded w-full">-</span>
{% endif %}
<span class="text-xs font-semibold text-slate-600 dark:text-slate-400">Allotment</span>
</div>
</div>
</div>
{% endif %}
</div>
{% endfor %}
</div>
</div>
{% endif %}

<!-- Counselling Information -->
{% if profile.counselling %}
<div class="bg-white dark:bg-[#1a202c] rounded-xl border border-[#e5e7eb] dark:border-[#2d3748] overflow-hidden shadow-md mb-6">
<div class="bg-gradient-to-r from-rose-500 to-rose-600 px-6 py-4">
<h3 class="text-white text-lg font-bold flex items-center gap-2">
<span class="material-symbols-outlined">how_to_vote</span>
Counselling
</h3>
</div>
<div class="overflow-x-auto">
<table class="w-full text-left border-collapse">
<thead>
<tr class="bg-slate-50 dark:bg-[#2d3748] border-b border-[#e5e7eb] dark:border-[#4a5568]">
<th class="px-6 py-3 text-xs font-bold text-slate-600 dark:text-slate-300 uppercase">App #</th>
<th class="px-6 py-3 text-xs font-bold text-slate-600 dark:text-slate-300 uppercase">Quota</th>
<th class="px-6 py-3 text-xs font-bold text-slate-600 dark:text-slate-300 uppercase">Allotted Dept</th>
<th class="px-6 py-3 text-xs font-bold text-slate-600 dark:text-slate-300 uppercase">Order #</th>
<th class="px-6 py-3 text-xs font-bold text-slate-600 dark:text-slate-300 uppercase">Consortium #</th>
<th class="px-6 py-3 text-xs font-bold text-slate-600 dark:text-slate-300 uppercase">Status</th>
</tr>
</thead>
<tbody class="divide-y divide-[#e5e7eb] dark:divide-[#2d3748]">
{% for c in profile.counselling %}
<tr class="hover:bg-slate-50 dark:hover:bg-[#2d3748] transition-colors">
<td class="px-6 py-3 text-sm font-semibold">{{ c.app_id }}</td>
<td class="px-6 py-3 text-sm">
{% if c.quota_type == 'GQ' %}
<span class="inline-flex px-2 py-1 rounded-full text-xs font-bold bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-300">General</span>
{% elif c.quota_type == 'MQ' %}
<span class="inline-flex px-2 py-1 rounded-full text-xs font-bold bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-300">Management</span>
{% else %}
{{ c.quota_type or 'N/A' }}
{% endif %}
</td>
<td class="px-6 py-3 text-sm font-bold text-green-600 dark:text-green-400">{{ c.dept_name or 'N/A' }}</td>
<td class="px-6 py-3 text-sm font-mono">{{ c.allotment_order_number or 'N/A' }}</td>
<td class="px-6 py-3 text-sm font-mono">{{ c.consortium_number or 'N/A' }}</td>
<td class="px-6 py-3 text-sm">
<span class="inline-flex px-2 py-1 rounded-full text-xs font-bold {% if c.status == 'Registered' %}bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300{% elif c.status == 'Allotted' %}bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300{% else %}bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-300{% endif %}">
{{ c.status or 'N/A' }}
</span>
</td>
</tr>
{% endfor %}
</tbody>
</table>
</div>
</div>
{% endif %}

<!-- Payment Records -->
{% if profile.payments %}
<div class="bg-white dark:bg-[#1a202c] rounded-xl border border-[#e5e7eb] dark:border-[#2d3748] overflow-hidden shadow-md mb-6">
<div class="bg-gradient-to-r from-emerald-500 to-emerald-600 px-6 py-4">
<h3 class="text-white text-lg font-bold flex items-center gap-2">
<span class="material-symbols-outlined">payments</span>
Payments
</h3>
</div>
<div class="overflow-x-auto">
<table class="w-full text-left border-collapse">
<thead>
<tr class="bg-slate-50 dark:bg-[#2d3748] border-b border-[#e5e7eb] dark:border-[#4a5568]">
<th class="px-6 py-3 text-xs font-bold text-slate-600 dark:text-slate-300 uppercase">App #</th>
<th class="px-6 py-3 text-xs font-bold text-slate-600 dark:text-slate-300 uppercase">Bill No</th>
<th class="px-6 py-3 text-xs font-bold text-slate-600 dark:text-slate-300 uppercase">Payment Mode</th>
<th class="px-6 py-3 text-xs font-bold text-slate-600 dark:text-slate-300 uppercase">Amount</th>
</tr>
</thead>
<tbody class="divide-y divide-[#e5e7eb] dark:divide-[#2d3748]">
{% for p in profile.payments %}
<tr class="hover:bg-slate-50 dark:hover:bg-[#2d3748] transition-colors">
<td class="px-6 py-3 text-sm font-semibold">{{ p.app_id }}</td>
<td class="px-6 py-3 text-sm font-bold">{{ p.bill_no or 'N/A' }}</td>
<td class="px-6 py-3 text-sm">
<span class="inline-flex px-2 py-1 rounded-full text-xs font-bold {% if p.mode_of_payment == 'Cash' %}bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300{% elif p.mode_of_payment == 'Card' %}bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300{% else %}bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300{% endif %}">
{{ p.mode_of_payment or 'N/A' }}
</span>
</td>
<td class="px-6 py-3 text-sm font-bold text-lg text-green-600 dark:text-green-400">â‚¹ {{ "%.2f"|format(p.amount or 0) }}</td>
</tr>
{% endfor %}
</tbody>
</table>
</div>
</div>
{% endif %}

</main>

<script>
function downloadPDF() {
    const button = event.target.closest('button');
    const originalText = button.innerHTML;
    button.innerHTML = '<span class="material-symbols-outlined text-sm animate-spin">refresh</span> Generating...';
    button.disabled = true;
    
    const element = document.querySelector('main');
    const studentName = '{{ profile.student.unique_id or "student" }}';
    
    const opt = {
        margin: 10,
        filename: `student_profile_${studentName}.pdf`,
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { 
            scale: 2,
            useCORS: true,
            logging: false,
            letterRendering: true
        },
        jsPDF: { 
            unit: 'mm', 
            format: 'a4', 
            orientation: 'portrait' 
        },
        pagebreak: { mode: ['avoid-all', 'css', 'legacy'] }
    };
    
    html2pdf().set(opt).from(element).save().then(() => {
        button.innerHTML = originalText;
        button.disabled = false;
    });
}
</script>

</body>
</html>
