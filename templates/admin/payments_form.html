<!DOCTYPE html>
<html class="light" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Payment Form - PMC Engineering</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Lexend:wght@100..900&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
<script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#137fec",
                        "background-light": "#f6f7f8",
                        "background-dark": "#101922",
                    },
                    fontFamily: {
                        "display": ["Lexend", "sans-serif"]
                    },
                    borderRadius: {"DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px"},
                },
            },
        }
    </script>
<style>
        body {
            font-family: 'Lexend', sans-serif;
        }
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark text-[#111418] dark:text-white min-h-screen flex flex-col">
<header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-[#e5e7eb] dark:border-[#2d3748] bg-white dark:bg-[#1a202c] px-6 py-3 sticky top-0 z-50">
<div class="flex items-center gap-4">
<div class="text-primary">
<svg fill="none" height="32" viewbox="0 0 48 48" width="32" xmlns="http://www.w3.org/2000/svg">
<path clip-rule="evenodd" d="M12.0799 24L4 19.2479L9.95537 8.75216L18.04 13.4961L18.0446 4H29.9554L29.96 13.4961L38.0446 8.75216L44 19.2479L35.92 24L44 28.7521L38.0446 39.2479L29.96 34.5039L29.9554 44H18.0446L18.04 34.5039L9.95537 39.2479L4 28.7521L12.0799 24Z" fill="currentColor" fill-rule="evenodd"></path>
</svg>
</div>
<h2 class="text-[#111418] dark:text-white text-lg font-bold leading-tight tracking-[-0.015em]">Er. Perumal Manimekalai College of Engineering</h2>
</div>
<div class="flex items-center gap-4">
<a href="{{ url_for('auth.logout') }}" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg">Logout</a>
</div>
</header>

<main class="flex-1 overflow-y-auto">
<div class="max-w-4xl mx-auto p-6 flex flex-col gap-6">
<a href="{{ url_for('admin.payments_list') }}" class="flex items-center gap-2 text-primary hover:text-primary/80 font-semibold mb-4">
<span class="material-symbols-outlined">arrow_back</span>
Back to Payments
</a>

{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, message in messages %}
        <div class="bg-{% if category == 'success' %}green{% elif category == 'error' %}red{% else %}blue{% endif %}-50 border border-{% if category == 'success' %}green{% elif category == 'error' %}red{% else %}blue{% endif %}-200 text-{% if category == 'success' %}green{% elif category == 'error' %}red{% else %}blue{% endif %}-800 px-4 py-3 rounded-lg">
            {{ message }}
        </div>
        {% endfor %}
    {% endif %}
{% endwith %}

<!-- Page Header -->
<div class="flex flex-wrap justify-between items-end gap-3">
<div class="flex min-w-72 flex-col gap-1">
<p class="text-[#111418] dark:text-white text-3xl font-black leading-tight tracking-[-0.033em]">Initial Payment</p>
<p class="text-[#617589] dark:text-[#a0aec0] text-base font-normal leading-normal">Collect initial payment for admission</p>
</div>
</div>

<!-- Student Information Card -->
<div class="bg-white dark:bg-[#1a202c] rounded-xl border border-[#e5e7eb] dark:border-[#2d3748] p-6">
<h3 class="text-lg font-bold text-[#111418] dark:text-white mb-4">Student Information</h3>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div>
            <label class="block text-sm font-semibold text-gray-600 mb-1">Student Name</label>
            <p class="text-lg font-bold text-gray-800">{{ student.full_name or student.name }}</p>
        </div>
        <div>
            <label class="block text-sm font-semibold text-gray-600 mb-1">Unique ID</label>
            <p class="text-lg font-bold text-blue-600">{{ student.unique_id or 'N/A' }}</p>
        </div>
        <div>
            <label class="block text-sm font-semibold text-gray-600 mb-1">Registration ID</label>
            <p class="text-lg font-bold text-green-600">{{ application.registration_id or 'N/A' }}</p>
        </div>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4 pt-4 border-t border-gray-200">
        <div>
            <label class="block text-sm font-semibold text-gray-600 mb-1">Allotted Department</label>
            <p class="text-lg font-bold text-gray-800">{{ dept_name }}</p>
        </div>
        <div>
            <label class="block text-sm font-semibold text-gray-600 mb-1">Allotted Quota</label>
                {% if quota_type == 'GQ' %}
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold bg-purple-100 text-purple-800">General Quota</span>
                {% elif quota_type == 'MQ' %}
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold bg-orange-100 text-orange-800">Management Quota</span>
                {% else %}
                <span class="text-sm text-gray-500">{{ quota_type }}</span>
                {% endif %}
        </div>
    </div>
</div>

<!-- Payment Form Card -->
<div class="bg-white dark:bg-[#1a202c] rounded-xl border border-[#e5e7eb] dark:border-[#2d3748] p-6">
<h3 class="text-lg font-bold text-[#111418] dark:text-white mb-6">Payment Details</h3>

<form method="POST" class="space-y-6">
    <!-- Bill Number -->
    <div>
        <label for="bill_no" class="block text-sm font-semibold text-gray-700 mb-2">
            <span class="flex items-center gap-2">
                <span class="material-symbols-outlined text-lg">receipt_long</span>
                Bill Number
            </span>
        </label>
        <input type="text" id="bill_no" name="bill_no" 
               value="{{ record.bill_no or '' }}" 
               placeholder="e.g., BILL-001, INV-2026-001"
               class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" 
               required/>
        <p class="text-xs text-gray-500 mt-1">Unique bill/invoice number for this payment</p>
    </div>

    <!-- Mode of Payment -->
    <div>
        <label for="mode_of_payment" class="block text-sm font-semibold text-gray-700 mb-2">
            <span class="flex items-center gap-2">
                <span class="material-symbols-outlined text-lg">account_balance_wallet</span>
                Mode of Payment
            </span>
        </label>
        <select id="mode_of_payment" name="mode_of_payment" 
                class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                required>
            <option value="">-- Select Mode of Payment --</option>
            <option value="Cash" {% if record and record.mode_of_payment == 'Cash' %}selected{% endif %}>Cash</option>
            <option value="Card" {% if record and record.mode_of_payment == 'Card' %}selected{% endif %}>Card (Debit/Credit)</option>
            <option value="Cheque" {% if record and record.mode_of_payment == 'Cheque' %}selected{% endif %}>Cheque</option>
            <option value="Bank Transfer" {% if record and record.mode_of_payment == 'Bank Transfer' %}selected{% endif %}>Bank Transfer</option>
            <option value="UPI" {% if record and record.mode_of_payment == 'UPI' %}selected{% endif %}>UPI</option>
        </select>
        <p class="text-xs text-gray-500 mt-1">Select the method used for payment</p>
    </div>

    <!-- Amount -->
    <div>
        <label for="amount" class="block text-sm font-semibold text-gray-700 mb-2">
            <span class="flex items-center gap-2">
                <span class="material-symbols-outlined text-lg">currency_rupee</span>
                Amount (â‚¹)
            </span>
        </label>
        <input type="number" id="amount" name="amount" step="0.01" min="0"
               value="{{ record.amount or '' }}" 
               placeholder="e.g., 50000"
               class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
               required/>
        <p class="text-xs text-gray-500 mt-1">Enter the payment amount in rupees</p>
    </div>

    <!-- UPI ID (visible only when UPI selected) -->
    <div id="upi-row" style="display: none;">
        <label for="upi_id" class="block text-sm font-semibold text-gray-700 mb-2">
            <span class="flex items-center gap-2">
                <span class="material-symbols-outlined text-lg">qr_code</span>
                UPI ID (e.g., name@bank)
            </span>
        </label>
        <input type="text" id="upi_id" name="upi_id"
               value="{{ record.upi_id or '' }}"
               placeholder="e.g., scb@upi or name@bank"
               class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" />
        <p class="text-xs text-gray-500 mt-1">Provide the payer's UPI ID when payment was made via UPI</p>
    </div>

    <!-- Form Actions -->
    <div class="flex gap-4 pt-4 border-t border-gray-200">
        <button type="submit" class="flex items-center gap-2 bg-primary hover:bg-primary/90 text-white font-bold py-3 px-6 rounded-lg transition-all active:scale-95">
            <span class="material-symbols-outlined">check_circle</span>
            {% if record %}Update Payment{% else %}Save Payment{% endif %}
        </button>
        <a href="{{ url_for('admin.payments_list') }}" class="flex items-center gap-2 bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-3 px-6 rounded-lg transition-all">
            <span class="material-symbols-outlined">close</span>
            Cancel
        </a>
    </div>
</form>
</div>
</div>
</main>
<script>
    function toggleUpiRow(){
        const sel = document.getElementById('mode_of_payment');
        const upiRow = document.getElementById('upi-row');
        const upiInput = document.getElementById('upi_id');
        if(!sel || !upiRow) return;
        if(sel.value === 'UPI'){
            upiRow.style.display = 'block';
            if(upiInput) upiInput.setAttribute('required','required');
        } else {
            upiRow.style.display = 'none';
            if(upiInput) upiInput.removeAttribute('required');
        }
    }
    document.addEventListener('DOMContentLoaded', function(){
        const sel = document.getElementById('mode_of_payment');
        if(sel){ sel.addEventListener('change', toggleUpiRow); }
        // initial toggle based on existing record
        toggleUpiRow();
    });
</script>
</body>
</html>
