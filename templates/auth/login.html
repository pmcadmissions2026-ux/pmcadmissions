<!DOCTYPE html>
<html class="light" lang="en"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Admin &amp; Super Admin Login | PMC Engineering</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#137fec",
                        "background-light": "#f6f7f8",
                        "background-dark": "#101922",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.25rem",
                        "lg": "0.5rem",
                        "xl": "0.75rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
<style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
  <!-- Ensure debug stubs exist early to avoid onclick ReferenceError -->
  <script>
    window.__dbg_manual_check = window.__dbg_manual_check || function(){
      try{ const el = document.getElementById('page-errors-overlay')||document.getElementById('dbg-output'); if(el) el.textContent += 'stub __dbg_manual_check invoked\n'; else console.log('stub __dbg_manual_check invoked'); }catch(e){console.log(e);}    
    };
    window.__dbg_show_keys = window.__dbg_show_keys || function(){
      try{ const el = document.getElementById('page-errors-overlay')||document.getElementById('dbg-output'); if(el) el.textContent += 'stub __dbg_show_keys invoked\n'; else console.log('stub __dbg_show_keys invoked'); }catch(e){console.log(e);}    
    };
  </script>
</head>
<body class="bg-background-light dark:bg-background-dark min-h-screen flex flex-col font-display">
<!-- Top Navigation Bar Component (Modified) -->
<header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 px-10 py-3">
<div class="flex items-center gap-4 text-slate-900 dark:text-white">
<div class="size-8 text-primary">
<svg fill="currentColor" viewbox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
<path d="M24 45.8096C19.6865 45.8096 15.4698 44.5305 11.8832 42.134C8.29667 39.7376 5.50128 36.3314 3.85056 32.3462C2.19985 28.361 1.76794 23.9758 2.60947 19.7452C3.451 15.5145 5.52816 11.6284 8.57829 8.5783C11.6284 5.52817 15.5145 3.45101 19.7452 2.60948C23.9758 1.76795 28.361 2.19986 32.3462 3.85057C36.3314 5.50129 39.7376 8.29668 42.134 11.8833C44.5305 15.4698 45.8096 19.6865 45.8096 24L24 24L24 45.8096Z"></path>
</svg>
</div>
<h2 class="text-slate-900 dark:text-white text-lg font-bold leading-tight tracking-[-0.015em]">PMC Admission Portal</h2>
</div>
<button class="flex min-w-[84px] cursor-pointer items-center justify-center rounded-lg h-10 px-4 bg-primary text-white text-sm font-bold leading-normal hover:bg-primary/90 transition-colors">
<span class="truncate">Technical Support</span>
</button>
</header>
<!-- Main Content Area -->
<main class="flex-1 flex items-center justify-center p-6">
<div class="w-full max-w-[480px] flex flex-col gap-2">
<!-- Login Card Container -->
<div class="bg-white dark:bg-slate-900 shadow-xl rounded-xl overflow-hidden border border-slate-100 dark:border-slate-800">
<!-- Header Image/Logo Section -->
<div class="p-8 pb-0 flex flex-col items-center">
<div class="w-20 h-20 mb-4 bg-primary/10 rounded-full flex items-center justify-center">
<span class="material-symbols-outlined text-primary text-4xl">school</span>
</div>
<h2 class="text-slate-900 dark:text-white tracking-tight text-2xl font-bold text-center">Staff Login</h2>
<p class="text-slate-500 dark:text-slate-400 text-sm font-normal text-center mt-2">
                        Er. Perumal Manimekalai College of Engineering
                    </p>
</div>
<!-- Form Section -->
<div class="p-8">
<!-- Flash Messages -->


<!-- Form -->
<form class="space-y-5" method="POST">
<div class="space-y-1.5">
<label class="text-sm font-semibold text-slate-700 dark:text-slate-300" for="employee-id">Email Address</label>
<div class="relative">
<span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-xl">person</span>
<input class="w-full pl-10 pr-4 py-2.5 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none transition-all" id="employee-id" placeholder="Enter your email" type="email" name="email" required/>
</div>
</div>
<div class="space-y-1.5">
<div class="flex justify-between items-center">
<label class="text-sm font-semibold text-slate-700 dark:text-slate-300" for="password">Password</label>
<a class="text-xs font-semibold text-primary hover:underline" href="#">Forgot password?</a>
</div>
<div class="relative">
<span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-xl">lock</span>
<input class="w-full pl-10 pr-10 py-2.5 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none transition-all" id="password" placeholder="••••••••" type="password" name="password" required/>
<button class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 dark:hover:text-slate-200" type="button" onclick="togglePassword()">
<span class="material-symbols-outlined text-xl" id="toggle-icon">visibility</span>
</button>
</div>
</div>
<div class="flex items-center gap-2 pt-2">
<input class="w-4 h-4 rounded border-slate-300 text-primary focus:ring-primary" id="remember" type="checkbox" name="remember"/>
<label class="text-sm text-slate-600 dark:text-slate-400" for="remember">Keep me logged in</label>
</div>
<!-- Login Button -->
<button class="w-full bg-primary text-white font-bold py-3 px-4 rounded-lg shadow-md hover:bg-primary/90 focus:ring-4 focus:ring-primary/30 transition-all flex items-center justify-center gap-2" type="submit">
<span>Secure Login</span>
<span class="material-symbols-outlined text-lg">login</span>
</button>
</form>
</div>
<!-- Footer of Card -->
<div class="px-8 py-4 bg-slate-50 dark:bg-slate-800/50 border-t border-slate-100 dark:border-slate-800 flex justify-center items-center">
<p class="text-xs text-slate-400 dark:text-slate-500 flex items-center gap-1">
<span class="material-symbols-outlined text-[14px]">verified_user</span>
                        Authorized Personnel Only
                    </p>
</div>
</div>
<!-- Global Footer -->
<footer class="mt-8 text-center text-slate-400 dark:text-slate-500 text-xs">
<p>© 2024 Er. Perumal Manimekalai College of Engineering. All rights reserved.</p>
<div class="mt-2 flex justify-center gap-4">
<a class="hover:text-primary transition-colors" href="#">Privacy Policy</a>
<a class="hover:text-primary transition-colors" href="#">Terms of Service</a>
</div>
</footer>
</div>
</main>
<!-- Visual Background Element -->
<div class="fixed inset-0 -z-10 overflow-hidden pointer-events-none">
<div class="absolute -top-[10%] -left-[10%] w-[40%] h-[40%] bg-primary/5 rounded-full blur-3xl"></div>
<div class="absolute -bottom-[10%] -right-[10%] w-[30%] h-[30%] bg-primary/10 rounded-full blur-3xl"></div>
</div>

<script>
function togglePassword() {
  const passwordInput = document.getElementById('password');
  const toggleIcon = document.getElementById('toggle-icon');
  
  if (passwordInput.type === 'password') {
    passwordInput.type = 'text';
    toggleIcon.textContent = 'visibility_off';
  } else {
    passwordInput.type = 'password';
    toggleIcon.textContent = 'visibility';
  }
}
</script>
<!-- Client config and login handler -->
<script src="/config.js"></script>
<script>
// Inline login handler using Supabase REST (reads client config from /config.js)
(function(){
  const form = document.querySelector('form');
  const emailEl = document.getElementById('employee-id');
  const passEl = document.getElementById('password');
  const submitBtn = form && form.querySelector('button[type=submit]');

  function showError(msg){ try{ alert(msg); }catch(e){ console.error(msg); } }

  if(!form) return;
  form.addEventListener('submit', async function(ev){
    ev.preventDefault();
    if(submitBtn) submitBtn.disabled = true;
    try{
      const SUPABASE_URL = (window.__ENV && window.__ENV.SUPABASE_URL) || '';
      const SUPABASE_KEY = (window.__ENV && window.__ENV.SUPABASE_KEY) || '';
      if(!SUPABASE_URL || !SUPABASE_KEY) return showError('Missing Supabase client configuration');
      const email = (emailEl && emailEl.value || '').trim();
      const password = (passEl && passEl.value || '');
      if(!email || !password) return showError('Enter email and password');

      const base = SUPABASE_URL.replace(/\/$/, '') + '/rest/v1';
      const q = `${base}/users?select=*&email=eq.${encodeURIComponent(email)}&password=eq.${encodeURIComponent(password)}`;
      const resp = await fetch(q, { headers: { apikey: SUPABASE_KEY, Authorization: 'Bearer ' + SUPABASE_KEY } });
      if(!resp.ok){ const txt = await resp.text().catch(()=>resp.statusText); return showError('Login failed: ' + resp.status + ' ' + txt); }
      const data = await resp.json();
      if(!Array.isArray(data) || data.length === 0) return showError('Invalid credentials');
      const user = data[0];
      if(user.is_active === false) return showError('Account inactive');

      // persist minimal session
      sessionStorage.setItem('pmc_user', JSON.stringify({ user_id: user.user_id, email: user.email, first_name: user.first_name, last_name: user.last_name, role_id: user.role_id }));

      // redirect by role: role_id === 1 => super admin, else admin
      const rid = Number(user.role_id || 0);
      if(rid === 1) window.location.href = '/admin/super_admin_dashboard';
      else window.location.href = '/admin/admin_dashboard';

    }catch(err){ console.error('login error', err); showError('Login error'); }
    finally{ if(submitBtn) submitBtn.disabled = false; }
  });
})();
</script>
<!-- Global debug helpers to avoid undefined onclicks -->
<script src="/static/js/global_debug.js"></script>
</body></html>
